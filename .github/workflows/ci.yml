name: CI Pipeline

on:
  push:
    branches:
      - main  # This workflow is triggered on every push to the 'main' branch.

jobs:
  build-and-test:
    runs-on: ubuntu-latest  # The job runs on the latest Ubuntu-based GitHub-hosted runner.

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
        # Retrieves the repository content so the project can be built and tested.

      - name: Set up Java 11
        uses: actions/setup-java@v3
        with:
          distribution: 'temurin'
          java-version: '11'
        # Installs JDK 11, which is required for running Scala and SBT.

      - name: Set up SBT
        uses: coursier/setup-action@v1
        with:
          apps: sbt
        # Installs the Scala Build Tool (SBT) for compiling and testing the project.

      - name: Run tests
        working-directory: ex7
        run: sbt test
        # Executes all unit tests defined in the project.

      - name: Build fat JAR
        working-directory: ex7
        run: sbt clean assembly
      # This step packages the entire project into a single JAR file including all dependencies.

      - name: Verify config file exists
        working-directory: ex7
        run: ls -la selfAnalysisConfig.json
      # Verifies that the configuration file exists before running the analysis.

      - name: Build thin JAR
        working-directory: ex7
        run: sbt package

      - name: Retrieve library jars from this project
        working-directory: ex7
        run: sbt copyDependencies

      - name: Run self-analysis
        working-directory: ex7
        run: java -jar target/scala-2.13/ex7-assembly-0.1.0.jar -config=selfAnalysisConfig.json
      # Runs the generated analysis tool on itself using a specified config file